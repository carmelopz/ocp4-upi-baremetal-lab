= Upgrade cluster

Mirror the Openshift registry with the new version image.

[source,bash]
----
export UPGRADE_TO="x.y.z-arch"

oc adm release mirror \
    --registry-config="src/registry/pull-secret.json" \
    --from="quay.io/openshift-release-dev/ocp-release:${UPGRADE_TO}" \
    --to="registry.ocp.bmlab.int:5000/ocp4/release" \
    --to-release-image="registry.ocp.bmlab.int:5000/ocp4/release:${UPGRADE_TO}" \
    --apply-release-image-signature \
    --insecure=true
----

Get the digest for the new version.

[source,bash]
----
export UPGRADE_TO_DIGEST=$(
    oc adm release info quay.io/openshift-release-dev/ocp-release:${UPGRADE_TO} |\
        sed -n 's/Pull From: .*@//p'
)
----

Upgrade to the desired version.

[source,bash]
----
oc adm upgrade \
    --force \
    --allow-explicit-upgrade \
    --to-image=registry.ocp.bmlab.int:5000/ocp4/release@${UPGRADE_TO_DIGEST}
----
